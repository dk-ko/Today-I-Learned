- 책에 대한 간단한 내용과   
*개인적인 생각*   
**토론한 내용**   
Q 궁금한 점에 대한 정리.  

---
# 8. 경계 간 매핑하기

- 각 계층의 모델을 매핑하는 방법, 장단점을 알아보기
<br>
- 매핑(두 계층을 연결하는 모델을 만드는 것)에 대한 찬반론
	- 찬: 같은 모델을 사용하면 두 계층이 강결함 됨. 즉 새로운 모델을 만들어 매핑해야함.
	- 반: 매핑하면 보일러플레이트 코드를 많이 만들게된다. 즉 너무 과하다.

## 매핑하지 않기 전략(No Mapping)
- 모든 계층이 같은 모델을 사용한다.
- 계층 간 매핑이 필요 없다.
- 웹 계층, 영속성 계층은 모델에 대한 요구사항이 추가될 수 있는데, 추가하는 경우 다른 계층에서는 불필요한 코드가 추가될 수 있다.
- 따라서 단일 책임 원칙(SRP)을 위반한다.
- 모든 계층이 정확히 같은 구조와 정보를 필요로 하면 이 전략이 적절하다.
- 조금이라도 달라지면 다른 전략을 취하자.
- 전략은 사용하다 바꾸면 된다.


## 양방향(Two-Way) 매핑 전략
- 각 계층이 전용 모델을 가진 매핑 전략
- 웹 모델 / 영속성 모델 / 서비스 모델 (유스케이스 포트 포함) 에서 각각 모델을 가진다
- 웹 계층에서 웹 모델을 인커밍 포트에서 필요한 도메인으로 매핑하고, 인커밍 포트에 의해 반환된 도메인 객체를 다시 웹 모델로 배핑
- 서비스 모델에서 양 방향으로 매핑하기 때문에 양방향 매핑
- 장점: 매핑하지 않기 다음으로 간단한 방식
- 단점: 많은 보일러플레이트 코드가 생김. 매핑 프레임워크가 내부 동작을 제네릭과 리플렉션으로 숨기는 경우 매핑로직을 디버깅하기도 어렵다.
- 단점: 도메인 모델이 통신에도 사용된다. 인커밍, 아웃고잉 포트에서 도메인 객체를 입력 파라미터와 반환값으로 사용하기 때문. 따라서 바깥 요구사항에 의한 변경에 취약해짐.


## 완전(Full) 매핑 전략
- 각 연산마다 별도의 입출력 모델을 받는다.
- SendMoneyUserCase 포트의 입력 모델로 동작하는 SendMoneyCommand 처럼 각 작업에 특화된 모델로 사용한다
- 이런 모델을 `command` `request` 와 같은 단어로 사용함. (Read는 `query`)
- 당연히 공수가 많이 들지만, 유지보수에는 좋다
- 이 매핑 전략을 전역 패턴으로 추천하진 않는다. 이는 웹계층(또는 인커밍 어댑터)-> 어플리케이션 계층 사이에서 상태 변경 유스케이스의 경계를 명확히할 때 사용하는게 좋다.
- 애플리케이션->영속성 계층은 매핑 오버헤드로 비추한다.
- **매핑 전략은 여러가지를 섞어써야한다. 은총알은 없다.**


## 단방향(One-Way) 매핑 전략
- 모든 계층의 모델들이 같은 인터페이스를 구현한다
- attribute에 대한 getter 메서드를 제공해 도메인 모델 상태를 캡슐화한다.
- 도메인 객체를 바깥으로 전달하고 싶을 때 매핑 없이 가능하다. 
- setter가 인터페이스에 노출되어 있지 않아 바깥에서 실수로 도메인 객체를 변경하는 일이 발생하지 않는다.
- 어플리케이션 계층에서는 이것을 실제 도메인 모델로 매핑해서 도메인 모델의 행동에 접근할 수 있다.
- DDD에 적합한 매핑 전략이다.
- **한 계층이 다른 계층으로부터 객체를 받으면 해당 계층에서 이용할 수 있도록 다른 무언가로 매핑해야 함.**
- 그래서 각 계층은 한 방향으로만 매핑한다.
- 계층 간의 모델이 비슷할 때 가장 효과적.
- 읽기 전용연산의 경우 상태 인터페이스가 필요한 모든 정보를 제공해 웹 계층에서 전용 모델을 매핑할 필요가 없다.


## 언제 어떤 매핑 전략을 사용할 것인지?
- 그때 그때 다르다.
- 한 전략 사용하려고 해서는 안된다.
- 팀마다 가이드라이든 작성하는 것이 좋다.
- ex) 변경 유스케이스와 쿼리 유스케이스는 서로 다른 매핑 가이드를 갖는다. 
	- 변경 유스케이스는 웹-애플리케이션 사이에서 유스케이션간 결합 제거를 위해 완전 매핑 전략.
		- 애플리케이션-영속성 계층 사이에서는 매핑하지 않기 전략을 사용
	- 쿼리 작업시, 웹-애플리케이션 사이에 매핑 오버헤드를 줄이기 위해 매핑하지 않기 전략 사용
		- but. 애플리케이션 계층에서 영속성 문제나 웹 문제를 다워야하는 경우 양방향 매핑으로 바꿔야함.
- 명확한 가이드가 있어야 제대로 쓸 수 있다.


## 유지보수 가능한 소프트웨어를 만드는데 어떤 도움이 될까?
- 매핑 가이드라인이 있다면 코드가 정확히 할 일만 하면서 유지보수하기 더 쉬워질 것.

